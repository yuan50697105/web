<!DOCTYPE html><#assign ctx=request.contextPath><#import "header.html" as head><#import "buttom.html" as foot><html><head>    <meta charset="utf-8"/>    <title>购物车</title>    <link rel="stylesheet" href="${ctx}/css/bootstrap.css"/>    <link rel="stylesheet" href="${ctx}/css/style.css"/>    <link rel="stylesheet" href="${ctx}/css/common.css"/>    <link rel="stylesheet" href="${ctx}/css/indent.css">    <link rel="stylesheet" href="${ctx}/css/shop_cart.css"/>    <link rel="stylesheet" href="${ctx}js/artDialog-6.0.2/css/ui-dialog.css">    <script type="text/javascript" src="${ctx}/js/jquery-1.11.0.js"></script>    <script type="text/javascript" src="${ctx}/js/bootstrap.js"></script><#--<script type="text/javascript" src="${ctx}/js/shop_cart.js"></script>-->    <script type="text/javascript" src="${ctx}/js/common.js"></script>    <script type="text/javascript" src="${ctx}js/artDialog-6.0.2/dist/dialog-min.js"></script>    <script>        /** 文档加载完 */        $(function () {            /** 获取全选复选框为它绑定点击事件 */            $("#check").click(function () {                /** 获取下面所有的checkbox,当全选选中时下面的全部选中,                 当全选没有选中时,下面不需要选中 */                /** 查询所有的input元素它的类型为checkbox并且id属性值以box_开头 */                $("input[type='checkbox'][id^='box_']").attr("checked", this.checked);                /** 计算商品的总金额 */                calcPrice();            });            /** 如果全选复选框没有选中的话，让它选中 */            if (!$("#check").attr("checked")) {                $("#check").trigger("click");            } else {                /** 计算商品的总金额 */                calcPrice();            }            /** 获取下面的checkbox为它们绑定点击事件 */            var boxs = $("input[type='checkbox'][id^='box_']");            boxs.click(function () {                /** 计算商品的总金额 */                calcPrice();                /** 让全选选中 */                $("#check").attr("checked", boxs.length == boxs.filter(":checked").length);            });            /** 获取反选复选框为它绑定点击事件 */            $("#uncheck").click(function () {                /** 迭代下面所有的checkbox */                boxs.each(function () {                    /** 让自己取选自己的checked属性值 */                    $(this).attr("checked", !this.checked);                });                /** 计算商品的总金额 */                calcPrice();                /** 让全选选中 */                $("#check").attr("checked", boxs.length == boxs.filter(":checked").length);            });            //提交订单js            $("#submitOrderBtn").click(function () {                var boxs = $("input[id^='box_']:checked");                if (boxs.length == 0) {                    var d = dialog({                        title: '温馨提示',                        content: '<font size=6 color=red>请选择需要提交的商品!</font>'                    });                    d.show();                    setTimeout(function () {                        d.close().remove();                    }, 1000);                } else {                    //获取选中的复选框的值（值是商品id）                    var ids = boxs.map(function (i, item) {                        return item.value;                    });                    $("#goodsIdArrays").val(ids.get());                    $("#subimtOrderForm").submit();                }            });        });        /** 定义计算商品总金额的函数 */        var calcPrice = function () {            /** 获取下面所有选中的checkbox */            var boxs = $("input[type='checkbox'][id^='box_']:checked");            /** 定义总金额 */            var total_price = 0;            /** 如果有选中的，就计算 */            if (boxs.length > 0) {                /** 迭代所有选中的checkbox */                boxs.each(function () {                    /** 获取价格 */                    var price = parseFloat($(this.id.replace("box", "#price")).val());                    /** 获取数量 */                    var num = parseInt($(this.id.replace("box", "#num")).val());                    /* 设置小计金额 **/                    total_price += (price * num);                });                /** 设置显示总金额 */                $("#total_price").html("¥ " + total_price + " 元");            } else {                /** 设置显示总金额 */                $("#total_price").html("¥ 0.00 元");            }        }        //商品的数量更新（保存到session中的购物车中）        var updateCar = function (type, goodsId) {            /*             type 表示操作  1 表示 减少商品数量  2 表示增加商品数量             goodsId 表示需要操作的商品，并且通过这个goodsId可以获取页面元素            */            var buyNum = parseInt($("#num_" + goodsId).val());            if (type == 1) {                //减少商品数量操作                if (buyNum == 1) {                    var d = dialog({                        title: '温馨提示',                        content: '<font size=6 color=red>商品数量不能为0!</font>'                    });                    d.show();                    setTimeout(function () {                        d.close().remove();                    }, 1000);                    return;                }                buyNum -= 1;            } else {                //增加商品数量操作                buyNum += 1;            }            var url = "${ctx}/shopCar/update/" + goodsId + "/" + buyNum;            var params = {"goodsId": goodsId, "buyNum": buyNum};            $.post(url, params, function (data) {                if (data.shopcarstatus == 0) {                    //更新商品数量显示框                    $("#num_" + goodsId).val(buyNum);                    //让商品数量显示框闪动提醒一下                    $("#num_" + goodsId).fadeOut(100).fadeIn(100);                    //更新购物车数量显示(页面元素在header_macro.html)                    $("#totalNum").text(data.totalNum);                    //计算小计                    numChange(goodsId);                    //重新计算商品总价                    calcPrice();                } else {                    alert("添加失败");                }            }, "json");        }        //删除购物车中的商品        function deleteCar(goodsId) {            var url = "${ctx}/shopCar/remove/" + goodsId;            var params = {"goodsId": goodsId};            $.post(url, function (data) {                if (data.shopcarstatus == 0) {                    $("#goods_" + goodsId).fadeToggle(500, function () {                        this.remove();                        //更新购物车数量显示(页面元素在header_macro.html)                        $("#totalNum").text(data.totalNum);                        //重新计算商品总价                        calcPrice();                    });                } else {                    alert("添加失败");                }            }, "json");        }        /** 购买数据文本框改变的时候计算小计 */        var numChange = function (goodsId) {            /** 获取购买数量 */            var num = $("#num_" + goodsId).val();            /** 对购买数量做判断 */            if (!/^\d+$/.test(num) || num < 1) {                $("#num_" + goodsId).val(1);                num = 1;            }            /** 获取单价 */            var price = parseFloat($("#price_" + goodsId).val());            /** 设置小计 */            $("#total_" + goodsId).html(num * price);            /** 计算商品的总金额 */            calcPrice();        }    </script>    <style>        .td_ input {            width: 20px;            height: 20px;        }        label {            background: none;        }        th {            text-align: center;        }        table {            text-align: center;        }        tr[id^="goods_"] td input[type="checkbox"] {            margin-left: -145px;        }        .right {            float: right;        }    </style><@head.headerjs/></head><body><@head.header/><div class="content">    <div class="container">        <div class="title">            <h2><a href="${ctx}/shopCar/show">购物车</a></h2>            <a href="${ctx}/customer/order/toSubmit">确认订单</a>            <a href="${ctx}/shopCar/show">购物车</a>        </div>        <table>            <thead>            <tr>                <th>                    <label>                        <input type="checkbox" id="check">                        <em>全选</em>                    </label>                </th>                <th>商品</th>                <th>商品标题</th>                <th>商品标价|优惠标价</th>                <th>购买数量</th>                <th>小计</th>                <th>操作</th>            </tr>            </thead>        <#if totalPrice gt 0>            <tbody>                <#list items as item>                <tr id="goods_${item.goods.id}" style="text-align: center">                    <td><input type="checkbox" id="box_${item.goods.id}" value="${item.goods.id}"                               style="text-align: left"></td>                    <td><img src="${ctx}/${item.goods.image}" alt="${item.goods.title}"></td>                    <td><a href="${ctx}/goods/detail/${item.goods.id}"><p>${item.goods.title}</p></a></td>                    <td>¥ <span>${item.goods.price}</span>|<span>${item.goods.favoritePrice}</span>                        <input type="hidden" value="${item.goods.favoritePrice}" id="price_${item.goods.id}"/>                    </td>                    <td class="td_">                        <a class="_jbtn" onclick="updateCar(1,${item.goods.id})" href="javascript:void(0);">-</a>                        <input type="text" value="${item.sum}" size="2" onblur="numChange(${item.goods.id})"                               id="num_${item.goods.id}"/>                        <a class="jbtn_" onclick="updateCar(2,${item.goods.id})" href="javascript:void(0);">+</a>                    </td>                    <td>¥ <span id="total_${item.goods.id}">${item.goods.favoritePrice*item.sum}</span></td>                    <td><a onclick="deleteCar(${item.goods.id})" href="javascript:void(0);">移除</a></td>                </tr>                </#list>            </tbody>            <tfoot>            <tr>                <td class="clear" colspan="7">                    <label class="left">                        <input type="checkbox" id="uncheck">                        <em>反选</em>                    </label>                    <span class="right" id="total_price">¥ ${totalPrice} 元</span>                    <font class="right">商品总价格:</font>                </td>            </tr>            </tfoot>        <#else>            <tbody>            <tr>                <td colspan="7" style="height:300px"><p style="font-size:14px;">您的购物车还是空的，赶紧行动吧！</p>                    <a style="font-size:13px;" href="${ctx}/">去购物 &gt;                        <img src="${ctx}/images/gwc.png" style="width:50px;height:50px;"></a></td>            </tr>            </tbody>        </#if>        </table>    <#if totalPrice gt 0>        <form id=subimtOrderForm action="${ctx}/customer/order/toSubmit" method="post">            <input type="hidden" name="goodsArrays" id="goodsIdArrays">            <p class="clear p2">                <input class="f18 white right" type="button" id="submitOrderBtn" value="提交订单"/>            </p>        </form>    </#if>    </div></div></div><@foot.footer/></body></html>